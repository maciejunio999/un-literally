{% extends 'base.html' %}

{% block head %}
<title>Un-Literally</title>
<style>
    .hidden {
        display: none;
    }
    .error-message {
        color: red;
        font-size: 14px;
        margin-left: 25px;
    }
</style>
{% endblock %}

{% block body %}

<div class="menu_header">
    <h1 style="text-align: center; color: #297400; text-decoration: underline;">Edit User</h1>
</div>

<div class="container_row" style="justify-content: space-around;">
    {% if session.show_log_out %}
        {% if session.username|length > 0 %}
            <h4 style="text-align: right; color: #297400; margin-right: 25px;">Logged: {{session.username}}</h4>
        {% endif %}
    {% else %}
        <h4 style="text-align: right; color: #297400; margin-right: 25px;">No one is logged in</h4>
    {% endif %}
</div>
<hr>
<div class="name">

    <form id="editUserForm" action="/update/user_{{user.id}}" method="POST" onsubmit="return validateForm()">
        <div class="input-group">
            <label for="username" class="label">Username:</label>
            <input type="text" name="username" id="username" class="input-field" value="{{user.username}}" required>
            <span id="usernameError" class="error-message"></span>
        </div>
        <br>
        <div class="input-group">
            <label for="role" class="label" style="margin-right: 10px;">Role:</label>
            <select name="role" id="role" style="margin-right: 80px;" class="input-field">
                <option value="1" {% if user.role_id == 1 %}selected{% endif %}>Admin</option>
                <option value="1" {% if user.role_id == 2 %}selected{% endif %}>ProUser</option>
                <option value="2" {% if user.role_id == 3 %}selected{% endif %}>PlainUser</option>
            </select>
        </div>
        <br>
        <div class="input-group hidden" id="password-group">
            <label for="password" class="label">Password:</label>
            <input type="password" name="password" id="password" minlength="5"  class="input-field" placeholder="Enter new password">
            <span id="passwordError" class="error-message"></span>
        </div>
        <br>
        <button type="button" style="width: 390px; margin-left: 25px" class="button" id="change-password-button" onclick="showPasswordField()">Change Password</button>
        <br>
        <button type="submit" style="width: 390px; margin-left: 25px" class="button">Update User</button>
    </form>
    <br>
    
    {% if session.repited_user %}
        <p style="color: red; margin-left: 25px;">{{ message }}</p>
    {% endif %}

</div>

<div class="container_column">
    <button class="back_button" onclick="window.location='/all_users'">Back</button>
</div>

{% if session.show_error %}
    <p>[!] There could be a timeout or an issue with the user data.</p>
{% endif %}

<script>
    function showPasswordField() {
        document.getElementById('password-group').classList.remove('hidden');
        document.getElementById('change-password-button').classList.add('hidden');
    }

    function validateForm() {
        let isValid = true;

        const usernameField = document.getElementById('username').value.trim();
        const passwordField = document.getElementById('password').value.trim();

        const usernameError = document.getElementById('usernameError');
        const passwordError = document.getElementById('passwordError');

        usernameError.textContent = '';
        passwordError.textContent = '';

        if (usernameField === "") {
            usernameError.textContent = 'Username cannot be empty or whitespace only.';
            isValid = false;
        }

        if (document.getElementById('password-group').classList.contains('hidden') === false && passwordField === "") {
            passwordError.textContent = 'Password cannot be empty or whitespace only.';
            isValid = false;
        }

        return isValid;
    }
</script>

{% endblock %}
